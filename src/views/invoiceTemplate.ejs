<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Sales Tax Invoice</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      margin: 40px;
      color: #000;
    }

    .header {
      text-align: center;
      margin-bottom: 10px;
      position: relative;
    }

    .logo {
      float: right;
      width: 130px;
      margin-top: -50px;
    }

    .flex-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .section p {
      margin: 4px 0;
      font-size: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #157492;
      padding: 6px 8px;
      font-size: 11px;
      text-align: center;
    }

    th {
      background-color: #2c7c93;
      color: white;
      font-weight: bold;
    }

    .summary-box {
      margin-top: 20px;
      width: 300px;
      float: right;
      background-color: #eee;
      padding: 12px;
      border: 1px solid #ccc;
      text-align: right;
    }

    .summary-box p {
      margin: 4px 0;
      font-size: 12px;
    }

    .total-in-words {
      margin-top: 40px;
      font-weight: bold;
      font-size: 12px;
      clear: both;
    }

    .qr-box {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 40px;
    }

    .fbr-logo {
      width: 140px;
    }

    .qr-box img {
      height: 100px;
      object-fit: contain;
    }

    .qr-image {
      width: 1in;
      height: 1in;
      object-fit: contain;
    }

    .clear {
      clear: both;
    }
  </style>
</head>

<body>
  <div class="header">
    <h2>Sales Tax Invoice</h2>
    <img class="logo" src="data:image/png;base64,<%= fbrLogoBase64 %>" alt="Company Logo" />
  </div>

  <div class="flex-row">
    <div class="invoice-info">
      <p><span class="invoice-label">Invoice #:</span>
        <%= invoice.invoiceNumber %>
      </p>
    </div>
    <div class="invoice-info">
      <p><span class="invoice-label">Date:</span>
        <%= invoice.invoiceDate %>
      </p>
    </div>
  </div>

  <div class="flex-row">
    <div class="buyer-info">
      <p><strong>Buyer:</strong></p>
      <p>
        <%= invoice.buyerBusinessName %>
      </p>
      <p>
        <%= invoice.buyerAddress %>
      </p>
      <p>REGION : <%= invoice.buyerProvince %>
      </p>
      <p>NTN : <%= invoice.buyerNTNCNIC %>
      </p>
      <p>TYPE : <%= invoice.buyerRegistrationType %>
      </p>
    </div>
    <div class="seller-info">
      <p><strong>Seller:</strong></p>
      <p>
        <%= invoice.sellerBusinessName %>
      </p>
      <p>
        <%= invoice.sellerAddress %>
      </p>
      <p>NTN : <%= invoice.sellerNTNCNIC %>
      </p>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>SR No.</th>
        <th>Description of goods</th>
        <th>HS code</th>
        <th>Quantity</th>
        <th>Rate</th>
        <th>Amount</th>
        <th>ST Rate</th>
        <th>Sales Tax</th>
        <th>Further Tax</th>
        <th>Net</th>
      </tr>
    </thead>
    <tbody>
      <% invoice.items.forEach((item, idx)=> { %>
        <tr>
          <td>
            <%= idx + 1 %>
          </td>
          <td>
            <%= item.productDescription %>
          </td>
          <td>
            <%= item.hsCode %>
          </td>
          <td>
            <%= item.quantity %>
          </td>
          <td>
            <%= item.fixedNotifiedValueOrRetailPrice %>
          </td>
          <td>
            <%= (parseFloat(item.totalValues) || 0).toFixed(2) %>
          </td>
          <td>
            <%= (parseFloat(item.rate) || 0).toFixed(2) %>
          </td>
          <td>
            <%= (parseFloat(item.salesTaxApplicable) || 0).toFixed(2) %>
          </td>
          <td>
            <%= (parseFloat(item.furtherTax) || 0).toFixed(2) %>
          </td>
          <td>
            <%= ((parseFloat(item.totalValues) || 0) + (parseFloat(item.salesTaxApplicable) || 0) +
              (parseFloat(item.furtherTax) || 0)).toFixed(2) %>
          </td>
        </tr>
        <% }) %>
    </tbody>
  </table>

  <% const subTotal=invoice.items.reduce((sum, i)=> sum + (i.totalValues || 0), 0);
    const gst = invoice.items.reduce((sum, i) => sum + (i.salesTaxApplicable || 0), 0);
    const further = invoice.items.reduce((sum, i) => sum + (i.furtherTax || 0), 0);
    const grandTotal = subTotal + gst + further;
    %>

    <div class="summary-box">
      <p>Sub Total: <%= subTotal.toFixed(2) %>
      </p>
      <p>GST: <%= gst.toFixed(2) %>
      </p>
      <p>Further Tax: <%= further.toFixed(2) %>
      </p>
      <p><strong>Total: RS. <%= grandTotal.toFixed(2) %></strong></p>
    </div>

    <div class="total-in-words" style="display: flex; position: relative; bottom: 70px;">
      <p>Total in words: <%= convertToWords(grandTotal) %> Rupees Only</p>
    </div>

    <!-- FBR logo on the left, QR code on the right -->
    <div class="qr-box" style="position: relative; bottom: 4rem;">
      <img src="data:image/png;base64,<%= companyLogoBase64 %>" alt="FBR Logo" class="fbr-logo" />
      <img src="<%= qrData %>" alt="QR Code" class="qr-image" />
    </div>


    <div class="clear"></div>
</body>

</html>